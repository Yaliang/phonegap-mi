function rawLocalToCache(e){var a={id:e.objectId,attributes:e,createdAt:e.createdAt,updatedAt:e.updatedAt};return a.get=function(e){return this.attributes[e]},a.toJSON=function(){return this.attributes},a}function cacheClear(){cacheUser=[],cachePhoto=[],cacheFriend=[],cacheChat=[],cacheMessage=[],cacheGroup=[]}function cacheInitialization(){cacheUser=[],cachePhoto=[],cacheFriend=[],cacheChat=[],cacheMessage=[],cacheGroup=[];var e,a,c,r,t=["User","Photo","Friend","Chat","Message","Group"];("undefined"==typeof localStorage.cacheVersion||localStorage.cacheVersion!=cacheVersion)&&(localStorage.clear(),localStorage.cacheVersion=cacheVersion);for(var h=0;h<t.length;h++){switch(e=[],a=0,c=[],r=[],t[h]){case"Photo":if("undefined"==typeof localStorage.cachePhoto)break;e=JSON.parse(localStorage.cachePhoto);break;case"User":if("undefined"==typeof localStorage.cacheUser)break;e=JSON.parse(localStorage.cacheUser);break;case"Friend":if("undefined"==typeof localStorage.cacheFriend)break;e=JSON.parse(localStorage.cacheFriend);break;case"Chat":if("undefined"==typeof localStorage.cacheChat)break;e=JSON.parse(localStorage.cacheChat);break;case"Group":if("undefined"==typeof localStorage.cacheGroup)break;e=JSON.parse(localStorage.cacheGroup);break;case"Message":if("undefined"==typeof localStorage.cacheMessage)break;e=JSON.parse(localStorage.cacheMessage)}if(0!=e.length){for(var o=0;o<e.length;o++){var n=e[o];c.push(rawLocalToCache(n)),r.push(e[o].objectId),Date.parse(n.updatedAt)>a&&(a=Date.parse(n.updatedAt))}switch(a=new Date(a),t[h]){case"User":cacheUser=c;break;case"Photo":cachePhoto=c;break;case"Friend":cacheFriend=c;break;case"Chat":cacheChat=c;break;case"Message":cacheMessage=c;break;case"Group":cacheGroup=c}ParseUpdateCache(t[h],r,a)}}}function CacheGetProfileByUserId(e,a,c){for(var r=!1,t=0;t<cacheUser.length;t++)if(cacheUser[t].id==e){a(cacheUser[t],c),r=!0;break}r||ParseGetProfileByUserId(e,a,c)}function CacheGetProfileByUsername(e,a,c){for(var r=!1,t=0;t<cacheUser.length;t++)if(cacheUser[t].get("username")==e){a(cacheUser[t],c),r=!0;break}r||ParseGetProfileByUsername(e,a,c)}function CacheGetProfilePhotoByUserId(e,a,c){for(var r=!1,t=0;t<cachePhoto.length;t++)if(cachePhoto[t].get("userId")==e){a(cachePhoto[t],c),r=!0;break}r||ParseGetProfilePhotoByUserId(e,a,c)}function CacheGetProfilePhotoByUsername(e,a,c){for(var r=!1,t=null,h=0;h<cacheUser.length;h++)if(cacheUser[h].get("username")==e){t=cacheUser[h].id;break}if(null!=t)for(h=0;h<cachePhoto.length;h++)if(cachePhoto[h].get("userId")==t){a(cachePhoto[h],c),r=!0;break}r||ParseGetProfilePhotoByUsername(e,a,c)}function CacheUpdateUser(e){if("undefined"!=typeof e){e=rawLocalToCache(JSON.parse(JSON.stringify(e)));for(var a=!1,c=0;c<cacheUser.length;c++)if(cacheUser[c].id==e.id){cacheUser.splice(c,1,e),a=!0;break}a||cacheUser.push(e),localStorage.cacheUser=JSON.stringify(cacheUser)}}function CacheUpdatePhoto(e){if("undefined"!=typeof e){e=rawLocalToCache(JSON.parse(JSON.stringify(e)));for(var a=!1,c=0;c<cachePhoto.length;c++)if(cachePhoto[c].get("userId")==e.get("userId")){cachePhoto.splice(c,1,e),a=!0;break}a||cachePhoto.push(e),localStorage.cachePhoto=JSON.stringify(cachePhoto)}}function CacheCheckFriend(e,a,c){for(var r=!1,t=0;t<cacheFriend.length;t++)if(cacheFriend[t].get("friend")==e&&cacheFriend[t].get("owner")==a){c(a,e,cacheFriend[t]),r=!0;break}r||c(a,e)}function CachePullNewFriendRequest(e,a,c){for(var r=[],t=0;t<cacheFriend.length;t++)cacheFriend[t].get("friend")==e&&0==cacheFriend[t].get("valid")&&r.push(cacheFriend[t]);c(r)}function CachePullMyFriend(e,a,c){for(var r=[],t=0;t<cacheFriend.length;t++)cacheFriend[t].get("owner")==e&&1==cacheFriend[t].get("valid")&&r.push(cacheFriend[t]);r.sort(function(e,a){return e.get("name")-a.get("name")}),c(r)}function CacheUpdateFriend(e){if("undefined"!=typeof e){e=rawLocalToCache(JSON.parse(JSON.stringify(e)));for(var a=!1,c=0;c<cacheFriend.length;c++)if(cacheFriend[c].id==e.id){cacheFriend.splice(c,1,e),a=!0;break}a||cacheFriend.push(e),localStorage.cacheFriend=JSON.stringify(cacheFriend)}}function CacheRemoveFriend(e){for(var a=0;a<cacheFriend.length;a++)if(cacheFriend[a].id==e.id){cacheFriend.splice(a,1);break}localStorage.cacheFriend=JSON.stringify(cacheFriend)}function CachePullMyChat(e,a){for(var c=[],r=0;r<cacheChat.length;r++)cacheChat[r].get("ownerId")!=e||cacheChat[r].get("hidden")||c.push(cacheChat[r]);c.sort(function(e,a){return Date.parse(a.updatedAt)-Date.parse(e.updatedAt)}),a(c)}function CacheGetChatByGroupId(e,a,c,r){for(var t,h=0;h<cacheChat.length;h++)if(cacheChat[h].get("ownerId")==e&&cacheChat[h].get("groupId")==a&&0==cacheChat[h].get("hidden")){t=cacheChat[h];break}c(t,r)}function CacheUpdateChat(e){if("undefined"!=typeof e){e=rawLocalToCache(JSON.parse(JSON.stringify(e)));for(var a=!1,c=0;c<cacheChat.length;c++)if(cacheChat[c].id==e.id){cacheChat.splice(c,1,e),a=!0;break}a||cacheChat.push(e),localStorage.cacheChat=JSON.stringify(cacheChat)}}function CacheDeleteChat(e){for(var a=0;a<cacheChat.length;a++)if(cacheChat[a].id==e.id){cacheChat.splice(a,1);break}localStorage.cacheCat=JSON.stringify(cacheChat)}function CacheSetGroupMemberChatObjectReadFalse(e,a,c,r){for(var t=!1,h=0;h<cacheGroup.length;h++)if(cacheGroup[h].id==a){ParseSetChatObjectReadFalseByCurrentIndexAndGroupId(e,cacheGroup[h].get("memberId"),0,a,c,r),t=!0;break}t||ParseSetGroupMemberChatObjectReadFalse(e,a,c,r)}function CacheGetGroupIdInPrivateChat(e,a){for(var c=!1,r=0;r<cacheGroup.length;r++)if(cacheGroup[r].get("memberId").length==e.length&&!cacheGroup[r].get("isGroupChat")){c=!0;for(var t=cacheGroup[r].get("memberId"),h=0;h<e.length;h++)if(-1==t.indexOf(e[h])){c=!1;break}if(c){a(cacheGroup[r]);break}}c||ParseGetGroupIdInPrivateChat(e,a)}function CacheGetGroupMember(e,a,c){for(var r=!1,t=0;t<cacheGroup.length;t++)if(cacheGroup[t].id==e){a(cacheGroup[t],c),r=!0;break}r||ParseGetGroupMember(e,a,c)}function CacheUpdateGroup(e){if("undefined"!=typeof e){e=rawLocalToCache(JSON.parse(JSON.stringify(e)));for(var a=!1,c=0;c<cacheGroup.length;c++)if(cacheGroup[c].id==e.id){cacheGroup.splice(c,1,e),a=!0;break}a||cacheGroup.push(e),localStorage.cacheGroup=JSON.stringify(cacheGroup)}}function CachePullChatMessage(e,a,c,r){for(var t=[],h=0;h<cacheMessage.length;h++)cacheMessage[h].get("groupId")==e&&(null==c||Date.parse(cacheMessage[h].get("createdAt"))<Date.parse(c))&&t.push(cacheMessage[h]);if(t.sort(function(e,a){return Date.parse(a.createdAt)-Date.parse(e.createdAt)}),t.length>a){var o=t.length-a;t.splice(a,o)}0==t.length?ParsePullAllMessageByGroupIdForCache(e,a,c,r):r(t)}function CacheGetLatestMessage(e,a,c){for(var r=null,t=null,h=0;h<cacheMessage.length;h++)cacheMessage[h].get("groupId")==e&&(null==r||Date.parse(cacheMessage[h].get("createdAt"))>=Date.parse(r))&&(t=cacheMessage[h],r=t.get("createdAt"));a(t,c)}function CacheUpdateMessage(e){if("undefined"!=typeof e){e=rawLocalToCache(JSON.parse(JSON.stringify(e)));for(var a=!1,c=0;c<cacheMessage.length;c++)if(cacheMessage[c].id==e.id){cacheMessage.splice(c,1,e),a=!0;break}a||cacheMessage.push(e),localStorage.cacheMessage=JSON.stringify(cacheMessage)}}var cacheUser=[],cachePhoto=[],cacheFriend=[],cacheChat=[],cacheMessage=[],cacheGroup=[],cacheVersion="1.0.4";