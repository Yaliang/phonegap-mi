function getFriendOptionsButton(e,t){if(t&&3==t){var r="<div class='send-friend-request chat-friend' onclick=\"startPrivateChat('"+e+"');\">Start Chat</div>";return void $("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar").append(r)}var n=function(e,t,r){if("undefined"==typeof r){var n=function(e,t,r){if("undefined"==typeof r){var n="<div class='send-friend-request'>Send Friend Request</div>";$("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar").append(n),$("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar > .send-friend-request").on("click",function(){sendFriendRequest(e)})}else{var i=r.id,o="<div class='send-friend-request accept-friend-request'>Accept</div>",a="<div class='reject-friend-request'>Reject</div>";$("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar").append(o+a),$("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar > .accept-friend-request").on("click",function(){$("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar > .accept-friend-request").unbind("click"),$("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar > .reject-friend-request").unbind("click");var t=function(e){var t=(e.id,e.get("friend"));$("#"+prefixForGetFriendOptionsButton+t+" > .custom-corners-people-near-by > .ui-bar > .reject-friend-request").remove(),$("#"+prefixForGetFriendOptionsButton+t+" > .custom-corners-people-near-by > .ui-bar > .accept-friend-request").addClass("chat-friend").removeClass("accept-friend-request"),$("#"+prefixForGetFriendOptionsButton+t+" > .custom-corners-people-near-by > .ui-bar > .chat-friend").html("Start Chat").on("click",function(){startPrivateChat(t)}),$("#body-bottom-button-send-request").html("Start Chat").unbind("click").on("click",function(){startPrivateChat(t)}),pushNotificationToDeviceByUserId(e.get("friend"),Parse.User.current().get("name")+" accepted your friend request!")};ParseAcceptFriendRequest(i,null,null,t)}),$("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar > .reject-friend-request").on("click",function(){var t=function(t){$("#"+prefixForGetFriendOptionsButton+t).slideUp("fast",function(){$("#"+prefixForGetFriendOptionsButton+t).remove()}),$("#body-bottom-button-send-request").html("Send Friend Request").unbind("click").on("click",function(){sendFriendRequest(e)})};ParseRejectFriendRequest(i,null,e,t)})}};CacheCheckFriend(e,t,n)}else{var i=r.get("valid");if(i){var o="<div class='send-friend-request chat-friend' onclick=\"startPrivateChat('"+t+"');\">Start Chat</div>";$("#"+prefixForGetFriendOptionsButton+t+" > .custom-corners-people-near-by > .ui-bar").append(o)}else{var a="<div class='send-friend-request'>Request Sent</div>";$("#"+prefixForGetFriendOptionsButton+t+" > .custom-corners-people-near-by > .ui-bar").append(a)}}};CacheCheckFriend(e,Parse.User.current().id,n)}function sendFriendRequest(e){var t=Parse.User.current();$("#"+prefixForGetFriendOptionsButton+e+" > .custom-corners-people-near-by > .ui-bar > .send-friend-request").unbind("click"),$("#body-bottom-button-send-request").unbind("click");var r=function(e){var t=e.get("friend");$("#"+prefixForGetFriendOptionsButton+t+" > .custom-corners-people-near-by > .ui-bar > .send-friend-request").html("Request Sent"),$("#body-bottom-button-send-request").html("Friend Request Sent"),pushNotificationToDeviceByUserId(e.get("friend"),Parse.User.current().get("name")+" wanna be your friend!")};ParseSendFriendRequest(t.id,e,r)}function acceptFriendRequest(e){$("#body-bottom-button-response-request-accept").unbind("click"),$("#body-bottom-button-response-request-reject").unbind("click");var t=function(e){var t=(e.id,e.get("friend"));$("#body-bottom-button-response-request-accept").before("<div class='ui-btn' id='body-bottom-button-send-request' style='clear: both'></div>").remove(),$("#body-bottom-button-response-request-reject").remove(),$("#body-bottom-button-send-request").html("Start Chat").unbind("click").on("click",function(){startPrivateChat(t)}),pushNotificationToDeviceByUserId(e.get("friend"),Parse.User.current().get("name")+" accepted your friend request!")};ParseAcceptFriendRequest(e,null,null,t)}function rejectFriendRequest(e,t){var r=function(e){$("#body-bottom-button-response-request-accept").before("<div class='ui-btn' id='body-bottom-button-send-request' style='clear: both'></div>").remove(),$("#body-bottom-button-response-request-reject").remove(),$("#body-bottom-button-send-request").html("Send Friend Request").unbind("click").on("click",function(){sendFriendRequest(e)})};ParseRejectFriendRequest(e,null,t,r)}function buildUserListElement(e,t,r,n,i){var o=e.get("name"),a=e.get("gender"),d=e.get("latitude"),s=e.get("longitude"),l=e.id,c=e.updatedAt,u="";return null!=t&&(u+="<li id='"+t+l+"'",u+=0==i.localeCompare("add-participant-list")?" class='ui-add-participant-unchecked'":" class='ui-friend-list-line' onclick=\"$.mobile.changePage('#page-display-user-profile'); displayUserProfile('"+l+"');\"",u+=">"),u+="<div class='custom-people-in-friend-list custom-corners'>",u+="<div class='ui-bar ui-bar-a'>",u+="<div><strong>"+o+"</strong></div>",u+="<div class='ui-icon-custom-gender' style='","undefined"!=a&&(a?(u+="background-image:url(./content/customicondesign-line-user-black/png/male-white-20.png);",u+="background-color:#8970f1;"):(u+="background-image:url(./content/customicondesign-line-user-black/png/female1-white-20.png);",u+="background-color:#f46f75;")),u+="'></div>",null!=r&&null!=n&&(u+="<div class='people-near-by-list-distance'>"+getDistance(d,s,r,n)+"km | "+convertTime(c)+"</div>"),u+="</div>",u+="</div>",null!=t&&(u+="</li>"),u}function listPeopleNearBy(){navigator.geolocation?geoWatchId=navigator.geolocation.watchPosition(showPeopleNearByList,showPeopleNearByListError):$("#page-people-near-by > .ui-content").html("<p style='padding: 1em'>Geolocation is not supported by this browser.</p>")}function stopGeoWatch(){navigator.geolocation.clearWatch(geoWatchId),$("#page-people-near-by > .ui-content").html("")}function getDistance(e,t,r,n){var i=e*Math.PI/180,o=r*Math.PI/180,a=t*Math.PI/180,d=n*Math.PI/180,s=i-o,l=a-d,c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(s/2),2)+Math.cos(i)*Math.cos(o)*Math.pow(Math.sin(l/2),2)));return c=6378.137*c,c=Math.round(100*c)/100,c.toString()}function showPeopleNearByList(e){var t=1,r=1,n="updatedAt";0==$("#body-people-near-by-list").length&&$("#page-people-near-by > .ui-content").html("<ul id='body-people-near-by-list' data-role='listview' data-inset='true' class='ui-listview ui-listview-inset ui-corner-all ui-shadow'></ul>");var i=function(e,t,r){for(var n=r.length-1;n>=0;n--)if(0==$("#body-people-near-by-list > #body-near-by-"+r[n].id).length){var i=buildUserListElement(r[n],"body-near-by-",e,t,"body-people-near-by-list"),o=r[n].id;$("#body-people-near-by-list").prepend(i);var a=function(e){var t=e.get("profilePhoto120");"undefined"==typeof t&&(t="./content/png/Taylor-Swift.png"),$("#body-near-by-"+e.get("userId")+" > .custom-people-in-friend-list").css("backgroundImage","url('"+t+"')")};CacheGetProfilePhotoByUserId(o,a),prefixForGetFriendOptionsButton="body-near-by-",getFriendOptionsButton(o)}else{var d=r[n].get("latitude"),s=r[n].get("longitude");$("#body-near-by-"+r[n].id+" > .custom-people-in-friend-list > .ui-bar-a > .people-near-by-list-distance").html(getDistance(d,s,e,t)+"km | "+convertTime(r[n].updatedAt))}};ParsePullUserByGeolocation(e.coords.latitude,e.coords.longitude,t,r,n,i)}function showPeopleNearByListError(e){var t=$("#page-people-near-by > .ui-content");switch(e.code){case e.PERMISSION_DENIED:t.html("<p style='padding: 1em'>Location request has been denied. Please turn on your location service and try again.</p>");break;case e.POSITION_UNAVAILABLE:t.html("<p style='padding: 1em'>Location information is currently unavailable. Please try again later.</p>");break;case e.TIMEOUT:t.html("<p style='padding: 1em'>Location request has timed out. Please check your network connection and try again.</p>");break;case e.UNKNOWN_ERROR:t.html("<p style='padding: 1em'>Location information is currently unavailable due to an unknown error. Please try again later.</p>")}}function bindSearchAutocomplete(){$("#body-list-search-user").on("filterablebeforefilter",function(e,t){var r=$(this),n=$(t.input),i=n.val();if(r.html(""),i&&i.length>0){var o=30,a=function(e){for(var t=0;t<e.length;t++){var r=buildUserListElement(e[t],"body-people-search-",null,null,"body-people-near-by-list"),n=e[t].id;$("#body-list-search-user").append(r);var i=function(e){var t=e.get("profilePhoto120");"undefined"==typeof t&&(t="./content/png/Taylor-Swift.png"),$("#body-people-search-"+e.get("userId")+" > .custom-people-in-friend-list").css("backgroundImage","url('"+t+"')")};CacheGetProfilePhotoByUserId(n,i),prefixForGetFriendOptionsButton="body-people-search-"}};ParseSearchUserByEmailAndName(i,o,"updatedAt",a)}})}function unbindSearchAutocomplete(){$("#body-list-search-user").unbind("filterablebeforefilter").html(""),$("#body-input-user-autocomplete").val("")}function pullMyFriendRequests(){$("#page-my-friend-requests > .ui-content").html("<ul id='body-friend-requests-list' class='ui-listview ui-listview-inset ui-corner-all ui-shadow'></ul>");var e="createdAt",t=function(e){0==e.length?($("#page-my-friend-requests > .ui-content").addClass("ui-hidden-accessible"),$("#body-new-friend-requests-btn").addClass("ui-hidden-accessible")):($("#page-my-friend-requests > .ui-content").removeClass("ui-hidden-accessible"),$("#body-new-friend-requests-btn").removeClass("ui-hidden-accessible"));for(var t=0;t<e.length;t++){var r=e[t].get("owner"),n=e[t].id,i=function(e,t){var r=buildUserListElement(e,"body-new-friend-request-",null,null,"body-people-near-by-list"),n=(t.friendObject.id,t.friendObject.get("owner"));$("#body-friend-requests-list").append(r);var i=function(e,t){var r=e.get("profilePhoto120");"undefined"==typeof r&&(r="./content/png/Taylor-Swift.png"),$("#body-new-friend-request-"+t.friendId+" > .custom-people-in-friend-list").css("backgroundImage","url('"+r+"')")};CacheGetProfilePhotoByUserId(n,i,{friendId:n}),prefixForGetFriendOptionsButton="body-new-friend-request-"};CacheGetProfileByUserId(r,i,{friendObject:e[t]}),ParseSetRequestRead(n)}};CachePullNewFriendRequest(Parse.User.current().id,e,t)}function pullMyFriendList(){$("#body-friend-list").html("");var e=function(e){0==e.length?($("#page-my-friend-requests > .ui-content").addClass("ui-hidden-accessible"),$("#body-new-friend-requests-btn").addClass("ui-hidden-accessible")):($("#page-my-friend-requests > .ui-content").removeClass("ui-hidden-accessible"),$("#body-new-friend-requests-btn").removeClass("ui-hidden-accessible"))};CachePullNewFriendRequest(Parse.User.current().id,"updatedAt",e);var t="createdAt";e=function(e){e.sort(function(e,t){return e.get("name")-t.get("name")});for(var t=0;t<e.length;t++){var r=e[t].get("friend");e[t].id;$("#body-friend-list").append("<li id='body-friend-list-"+r+"' class='ui-friend-list-line' onclick=\"setCurrLocationHash('#page-friend'); $.mobile.changePage('#page-display-user-profile'); displayUserProfile('"+r+"');\"></li>");var n=function(e,t){var r=buildUserListElement(e,null,null,null,"friend-list"),n=(t.friendObject.id,t.friendObject.get("friend"));$("#body-friend-list-"+e.id).append(r);var i=function(e,t){var r=e.get("profilePhoto120");"undefined"==typeof r&&(r="./content/png/Taylor-Swift.png"),$("#body-friend-list-"+t.friendId+">.custom-people-in-friend-list").css("backgroundImage","url('"+r+"')")};CacheGetProfilePhotoByUserId(n,i,{friendId:n}),prefixForGetFriendOptionsButton="body-friend-list-"};CacheGetProfileByUserId(r,n,{friendObject:e[t]})}},CachePullMyFriend(Parse.User.current().id,t,e)}function pullFriendListForAddingParticipants(){$("#body-add-participants-list").html(""),$("#header-add-participant-for-group-chat").html("OK").unbind("click");var e=($("#footer-bar-group-id-label").html(),"createdAt"),t=function(e){e.sort(function(e,t){return e.get("name")-t.get("name")});for(var t=0;t<e.length;t++){var r=e[t].get("friend");e[t].id;$("#body-add-participants-list").append("<li id='body-add-participants-list-"+r+"' class='ui-friend-list-line'></li>"),$("#body-add-participants-list-"+r).click({id:r},selectANewParticipant);var n=function(e,t){var r=buildUserListElement(e,"body-add-participants-people-",null,null,"add-participant-list"),n=(t.friendObject.id,t.friendObject.get("friend"));$("#body-add-participants-list-"+e.id).append(r);var i=function(e,t){var r=e.get("profilePhoto120");"undefined"==typeof r&&(r="./content/png/Taylor-Swift.png"),$("#body-add-participants-people-"+t.friendId+">.custom-people-in-friend-list").css("backgroundImage","url('"+r+"')")};CacheGetProfilePhotoByUserId(n,i,{friendId:n}),prefixForGetFriendOptionsButton="body-add-participants-list-"};CacheGetProfileByUserId(r,n,{friendObject:e[t]})}var i=$("#footer-bar-group-id-label").html(),o=function(e,t){var r=e.get("memberId");newGroupChatMemberArray.groupId=e.id,newGroupChatMemberArray.isGroupChat=e.get("isGroupChat"),newGroupChatMemberArray.memberId=$.merge([],r),newGroupChatMemberArray.prevNum=r.length,newGroupChatMemberArray.newNum=0,newGroupChatMemberArray.newMemberList=[];for(var n=0;n<r.length;n++)$("#body-add-participants-list-"+r[n]).unbind("click"),$("#body-add-participants-people-"+r[n]).removeClass("ui-add-participant-unchecked").addClass("ui-add-participant-checked")};CacheGetGroupMember(i,o,{})};CachePullMyFriend(Parse.User.current().id,e,t)}function pullFriendListForSelectingParticipantsInNewGroup(){$("#body-add-participants-list").html(""),$("#header-add-participant-for-group-chat").html("OK").unbind("click"),newGroupChatMemberArray.prevNum=0,newGroupChatMemberArray.newNum=0,newGroupChatMemberArray.newMemberList=[];var e="createdAt",t=function(e){e.sort(function(e,t){return e.get("name")-t.get("name")});for(var t=0;t<e.length;t++){var r=e[t].get("friend");e[t].id;$("#body-add-participants-list").append("<li id='body-add-participants-list-"+r+"' class='ui-friend-list-line'></li>"),$("#body-add-participants-list-"+r).click({id:r},selectANewParticipant);var n=function(e,t){var r=buildUserListElement(e,"body-add-participants-people-",null,null,"add-participant-list"),n=(t.friendObject.id,t.friendObject.get("friend"));$("#body-add-participants-list-"+e.id).append(r);var i=function(e,t){var r=e.get("profilePhoto120");"undefined"==typeof r&&(r="./content/png/Taylor-Swift.png"),$("#body-add-participants-people-"+t.friendId+">.custom-people-in-friend-list").css("backgroundImage","url('"+r+"')")};CacheGetProfilePhotoByUserId(n,i,{friendId:n}),prefixForGetFriendOptionsButton="body-add-participants-list-"};CacheGetProfileByUserId(r,n,{friendObject:e[t]})}};CachePullMyFriend(Parse.User.current().id,e,t)}function pullParticipantsListInGroup(){$("#body-group-participants-list").html("");var e=$("#footer-bar-group-id-label").html(),t=function(e,t){for(var r=e.get("memberId"),n=0;n<r.length;n++){$("#body-group-participants-list").append("<li id='body-group-participants-list-"+r[n]+"'></li>"),$("#body-group-participants-list-"+r[n]).click({id:r[n]},function(e){displayUserProfile(e.data.id)});var i=function(e){var t=buildUserListElement(e,"body-group-participants-people-",null,null,"group-participant-list");$("#body-group-participants-list-"+e.id).append(t);var r=function(e,t){var r=e.get("profilePhoto120");"undefined"==typeof r&&(r="./content/png/Taylor-Swift.png"),$("#body-group-participants-people-"+t.userId+">.custom-people-in-friend-list").css("backgroundImage","url('"+r+"')")};CacheGetProfilePhotoByUserId(e.id,r,{userId:e.id})};CacheGetProfileByUserId(r[n],i)}};CacheGetGroupMember(e,t,{})}var prefixForGetFriendOptionsButton="",geoWatchId,newGroupChatMemberArray={groupId:null,memberId:[],prevNum:0,newNum:0,newMemberList:[]};