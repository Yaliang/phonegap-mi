function ParseSignup(e,n,s,r,t,a,c){var u=new Parse.User;u.set("username",e),u.set("password",n),u.set("email",s),u.set("name",r),u.signUp(null,{success:function(e){setCurrLocationHash(a),$.mobile.changePage(a),c(e)},error:function(e,n){$.mobile.loading("hide"),t.html(n.message),$("#body-input-signup-password").val("")}})}function ParseUpdateBridgeit(e){var n=Parse.User.current();n.set("bridgeitId",e),n.save()}function ParseCreateProfilePhotoObject(e){var n=Parse.Object.extend("Photo"),s=new n;s.set("userId",e),s.save()}function ParseLogin(e,n,s,r,t){Parse.User.logIn(e,n,{success:function(e){setCurrLocationHash(r),$.mobile.changePage(r),t(),CacheUpdateUser(e)},error:function(n,r){$.mobile.loading("hide"),$("#body-input-login-password").val("");var t=new Parse.Query(Parse.User);t.equalTo("username",e),t.find({success:function(e){s.html(0==e.length?"Email does not exist.":"Password does not match your email.")},error:function(){s.html("Failed to connect to server, please try again later.")}})}})}function ParseConfirmPassword(e,n,s){Parse.User.logIn(Parse.User.current().getUsername(),e,{success:function(e){n()},error:function(e,n){s(n)}})}function ParseChangePassword(e,n,s){var r=Parse.User.current();r.set("password",e),r.save(null,{success:function(e){n()},error:function(e,n){s(n)}})}function ParseRemoveCurrentBridgeitId(){var e,n=Parse.User.current();n.set("bridgeitId",e),n.save()}function ParseLogout(e){Parse.User.logOut(),setCurrLocationHash(e),$.mobile.changePage(e)}function ParseUpdateCurrentUser(e,n){var s=Parse.User.current();s.fetch({success:function(n){e(),CacheUpdateUser(n)},error:function(e,s){n()}})}function ParseEventCreate(e,n,s,r,t,a,c,u,o,i,d){var l=Parse.Object.extend("UserEvent"),f=new l;f.set("owner",e),f.set("title",n),f.set("location",s),f.set("time",r),f.set("startTimeInMilliseconds",t),f.set("endTimeInMilliseconds",a),f.set("visibility",c),f.set("description",u),f.set("commentNumber",0),f.set("reportNum",0),f.save(null,{success:function(e){d(e),$.mobile.changePage(i)},error:function(e,n){o.html("Error: "+n.code+" "+n.message)}})}function ParseEventEditSave(e,n,s,r,t,a,c,u,o,i,d,l){var f=Parse.Object.extend("UserEvent"),P=new Parse.Query(f);P.get(l,{success:function(l){l.set("owner",e),l.set("title",n),l.set("location",s),l.set("time",r),l.set("startTimeInMilliseconds",t),l.set("endTimeInMilliseconds",a),l.set("visibility",c),l.set("description",u),l.save(null,{success:function(e){d(e),$.mobile.changePage(i)},error:function(e,n){o.html("Error: "+n.code+" "+n.message)}})}})}function ParseUpdateReport(e,n){var s=Parse.Object.extend("UserEvent"),r=new Parse.Query(s);r.get(e,{success:function(e){e.increment("reportNum",1),e.addUnique("reportUserId",Parse.User.current().id),e.save(null,{success:function(e){n(e)}})}})}function ParsePullEvent(e){var n=Parse.Object.extend("UserEvent"),s=new Parse.Query(n);"owner"in e&&null!=e.owner?s.equalTo("owner",e.owner):(s.lessThan("reportNum",11),s.notEqualTo("reportUserId",Parse.User.current().id)),"limitNumber"in e&&null!=e.limitNumber&&s.limit(e.limitNumber),"accessibility"in e&&null!=e.accessibility&&"public"==e.accessibility&&s.equalTo("visibility",!0),"descendingOrderKey"in e&&null!=e.descendingOrderKey&&s.descending(e.descendingOrderKey),"beforeAt"in e&&"undefined"!=typeof e.beforeAt&&null!=e.beforeAt&&s.lessThan("createdAt",e.beforeAt),"eventId"in e&&null!=e.eventId&&s.equalTo("objectId",e.eventId),s.find({success:function(n){e.displayFunction(n)}})}function ParseSelectEvent(e,n){var s=Parse.Object.extend("UserEvent"),r=new Parse.Query(s);r.equalTo("objectId",e),r.find({success:function(e){n(e)}})}function ParsePullEventComment(e){var n=Parse.Object.extend("Comment"),s=new Parse.Query(n);s.equalTo("eventId",e.eventId),s.descending(e.descendingOrderKey),"limitNumber"in e&&null!=e.limitNumber&&s.limit(e.limitNumber),"beforeAt"in e&&null!=e.beforeAt&&s.lessThan("createdAt",e.beforeAt),s.find({success:function(n){e.displayFunction(n)}})}function ParseAddEventComment(e,n,s,r){var t=Parse.Object.extend("Comment"),a=new t,c=Parse.User.current();a.set("eventId",e),a.set("owner",n),a.set("ownerName",c.get("name")),a.set("content",s),"replyToUserId"in r&&null!=r.replyToUserId&&a.set("replyToUserId",r.replyToUserId),a.save(null,{success:function(n){r.displayNewComment(n),ParseUpdateEventCommentNumber(1,e,r)},error:function(e,n){r.errorFunction("Error: "+n.code+" "+n.message)}})}function ParseUpdateEventCommentNumber(e,n,s){var r=Parse.Object.extend("UserEvent"),t=new Parse.Query(r);t.get(n,{success:function(n){n.increment("commentNumber",e),n.save(null,{success:function(e){s.successFunction(e,s)},error:function(e,n){s.errorFunction("Error: "+n.code+" "+n.message)}})},error:function(e,n){s.errorFunction("Error: "+n.code+" "+n.message)}})}function ParseAddInterest(e,n){var s=Parse.Object.extend("UserEvent"),r=new Parse.Query(s);r.get(e,{success:function(e){e.addUnique("interestId",Parse.User.current().id),e.save(null,{success:function(e){n(e)}})}})}function ParseRemoveInterest(e,n){var s=Parse.Object.extend("UserEvent"),r=new Parse.Query(s);r.get(e,{success:function(e){e.remove("interestId",Parse.User.current().id),e.save(null,{success:function(e){n(e)}})}})}function ParseAddGoing(e,n){var s=Parse.Object.extend("UserEvent"),r=new Parse.Query(s);r.get(e,{success:function(e){e.addUnique("goingId",Parse.User.current().id),e.save(null,{success:function(e){n(e)}})}})}function ParseRemoveGoing(e,n){var s=Parse.Object.extend("UserEvent"),r=new Parse.Query(s);r.get(e,{success:function(e){e.remove("goingId",Parse.User.current().id),e.save(null,{success:function(e){n(e)}})}})}function ParseDeleteEvent(e,n){var s=Parse.Object.extend("UserEvent"),r=new Parse.Query(s);r.get(e,{success:function(s){s.destroy({success:function(s){n(e)}})}})}function ParseGetProfileByUsername(e,n,s){var r=new Parse.Query(Parse.User);r.equalTo("username",e),r.first({success:function(e){n(e,s),CacheUpdateUser(e)}})}function ParseGetProfileByUserId(e,n,s){var r=new Parse.Query(Parse.User);r.equalTo("objectId",e),r.first({success:function(e){n(e,s),CacheUpdateUser(e)}})}function ParseSaveProfile(e,n,s,r,t,a,c,u,o){var i=Parse.User.current();i.set("name",e),i.set("gender",n),i.set("birthdate",s),i.set("motto",r),i.set("major",t),i.set("school",a),i.set("interest",c),i.set("location",u),i.save(null,{success:function(e){o(),CacheUpdateUser(e)}})}function ParseSaveProfilePhoto(e,n,s,r){var t=Parse.Object.extend("Photo"),a=new Parse.Query(t);null!=n&&(a.equalTo("userId",e),a.first({success:function(e){e.set("profilePhoto120",s);var t=new Parse.File(n.name,n);t.save().then(function(n){e.set("profilePhoto",n.url()),e.save(null,{success:function(e){r(e),CacheUpdatePhoto(e)}})},function(e){})}}))}function ParseGetProfilePhotoByUserId(e,n,s){var r=Parse.Object.extend("Photo"),t=new Parse.Query(r);t.equalTo("userId",e),t.first({success:function(e){n(e,s),CacheUpdatePhoto(e)}})}function ParseGetProfilePhotoByUsername(e,n,s){var r=Parse.Object.extend("User"),t=new Parse.Query(r);t.equalTo("username",e),t.first({success:function(e){ParseGetProfilePhotoByUserId(e.id,n,s)}})}function ParsePullUserByGeolocation(e,n,s,r,t,a){var c=Parse.User.current();c.set("latitude",e),c.set("longitude",n),c.save();var u=new Parse.Query(Parse.User);u.notEqualTo("username",c.getUsername()),u.greaterThan("latitude",e-s/2),u.lessThan("latitude",e+s/2),u.greaterThan("longitude",n-r/2),u.lessThan("longitude",n+r/2),u.descending(t),u.find({success:function(s){a(e,n,s)}})}function ParseSendFriendRequest(e,n,s){var r=Parse.Object.extend("Friend"),t=new Parse.Query(r);t.equalTo("owner",e),t.equalTo("friend",n),t.first({success:function(t){if("undefined"==typeof t){var a=new r;a.set("owner",e),a.set("friend",n),a.set("valid",!1),a.set("read",!1),a.save(null,{success:function(e){s(e),CacheUpdateFriend(e)}})}else s(t),CacheUpdateFriend(t)}})}function ParseAcceptFriendRequest(e,n,s,r){var t=Parse.Object.extend("Friend"),a=new Parse.Query(t);null!=e?a.equalTo("objectId",e):(a.equalTo("owner",n),a.equalTo("friend",s)),a.first({success:function(e){e.set("valid",!0),e.set("read",!0),e.save(null,{success:function(e){CacheUpdateFriend(e);var n=e.get("friend"),s=e.get("owner"),a=new Parse.Query(t);a.equalTo("owner",n),a.equalTo("friend",s),a.first({success:function(e){if("undefined"==typeof e){var a=new t;a.set("owner",n),a.set("friend",s),a.set("valid",!0),a.set("read",!0),a.save(null,{success:function(e){r(e),CacheUpdateFriend(e)}})}else e.set("valid",!0),e.set("read",!0),e.save(null,{success:function(e){r(e),CacheUpdateFriend(e)}})}})}})}})}function ParseRejectFriendRequest(e,n,s,r){var t=Parse.Object.extend("Friend"),a=new Parse.Query(t);null!=e?a.equalTo("objectId",e):(a.equalTo("owner",n),a.equalTo("friend",s)),a.first({success:function(e){CacheRemoveFriend(e),e.destroy({success:function(e){r(s)}})}})}function ParsePullNewFriendRequest(e,n,s){var r=Parse.Object.extend("Friend"),t=new Parse.Query(r);t.equalTo("friend",e),t.equalTo("valid",!1),t.descending(n),t.find({success:function(e){s(e);for(var n=0;n<e.length;n++)CacheUpdateFriend(e[n])}})}function ParsePullUnreadFriendRequest(e,n){var s=Parse.Object.extend("Friend"),r=new Parse.Query(s);r.equalTo("friend",e),r.equalTo("read",!1),r.find({success:function(e){n(e);for(var s=0;s<e.length;s++)CacheUpdateFriend(e[s])}})}function ParseCheckFriend(e,n,s){var r=Parse.Object.extend("Friend"),t=new Parse.Query(r);t.equalTo("owner",e),t.equalTo("friend",n),t.first({success:function(r){s(e,n,r),CacheUpdateFriend(r)}})}function ParsePullMyFriend(e,n,s){var r=Parse.Object.extend("Friend"),t=new Parse.Query(r);t.equalTo("owner",e),t.equalTo("valid",!0),t.descending(n),t.find({success:function(e){s(e);for(var n=0;n<e.length;n++)CacheUpdateFriend(e[n])}})}function ParsePullAllFriendObjectById(e){var n=Parse.Object.extend("Friend"),s=new Parse.Query(n);s.equalTo("owner",e);var r=new Parse.Query(n);r.equalTo("friend",e);var t=Parse.Query.or(s,r);t.find({success:function(e){for(var n=0;n<e.length;n++)CacheUpdateFriend(e[n])}})}function ParseSearchUserByEmailAndName(e,n,s,r){var t=new Parse.Query(Parse.User),a=new Parse.Query(Parse.User),c=Parse.User.current();t.matches("username",".*"+e+".*"),a.matches("name",".*"+e+".*");var u=Parse.Query.or(t,a);u.notEqualTo("username",c.getUsername()),u.descending(s),null!=n&&u.limit(n),u.find({success:function(e){r(e)}})}function ParseSetRequestRead(e){var n=Parse.Object.extend("Friend"),s=new Parse.Query(n);s.get(e,{success:function(e){e.set("read",!0),e.save()}})}function ParseGetGroupIdInPrivateChat(e,n){var s=Parse.Object.extend("Group"),r=new Parse.Query(s);r.containsAll("memberId",e),r.equalTo("isGroup",!1),r.first({success:function(r){if("undefined"==typeof r){var t=new s;t.set("memberId",e),e.length>2?t.set("isGroupChat",!0):t.set("isGroupChat",!1),t.save(null,{success:function(e){n(e),CacheUpdateGroup(e)}})}else n(r),CacheUpdateGroup(r)}})}function ParseCreateNewGroup(e,n){var s=Parse.Object.extend("Group"),r=new s;r.set("memberId",e),e.length>2?r.set("isGroupChat",!0):r.set("isGroupChat",!1),r.save(null,{success:function(e){n(e),CacheUpdateGroup(e)}})}function ParseGetGroupMember(e,n,s){var r=Parse.Object.extend("Group"),t=new Parse.Query(r);t.get(e,{success:function(e){n(e,s),CacheUpdateGroup(e)}})}function ParseSetGroupName(e,n,s){var r=Parse.Object.extend("Group"),t=new Parse.Query(r);t.get(e,{success:function(e){e.set("groupName",n),e.save(null,{success:function(e){s(e),CacheUpdateGroup(e)}})}})}function ParseSetChatObjectAsRead(e,n,s,r){var t=Parse.Object.extend("Chat"),a=new Parse.Query(t);a.equalTo("ownerId",e),a.equalTo("groupId",n),a.first({success:function(a){if("undefined"==typeof a){var c=new t;c.set("ownerId",e),c.set("groupId",n),c.set("hidden",!0),c.set("unreadNum",0),c.save(null,{success:function(e){r(e),CacheUpdateChat(e)}})}else null==s&&(s=a.get("unreadNum")),0!=s?(a.increment("unreadNum",-s),a.set("hidden",!1),a.save(null,{success:function(e){r(e),CacheUpdateChat(e)}})):(r(a),CacheUpdateChat(a))}})}function ParseAddGroupMember(e){var n=Parse.Object.extend("Group"),s=new Parse.Query(n);s.get(e.groupId,{success:function(n){for(var s=0;s<e.newMemberList.length;s++)n.addUnique("memberId",e.newMemberList[s]);n.set("isGroupChat",!0),n.save(null,{success:function(n){e.successFunction(n),CacheUpdateGroup(n)}})}})}function ParseRemoveGroupMember(e){var n=Parse.Object.extend("Group"),s=new Parse.Query(n);s.get(e.groupId,{success:function(n){for(var s=0;s<e.removeMemberList.length;s++)n.remove("memberId",e.removeMemberList[s]);n.save(null,{success:function(n){e.successFunction(n,e.data),CacheUpdateGroup(n)}})}})}function ParseInitializeChatObjectInGroup(e){var n=Parse.Object.extend("Chat"),s=new Parse.Query(n);s.equalTo("ownerId",e.ownerId),s.equalTo("groupId",e.groupId),s.first({success:function(n){if("undefined"==typeof n){var s=Parse.Object.extend("Chat"),r=new s;r.set("ownerId",e.ownerId),r.set("groupId",e.groupId),r.set("hidden",!1),r.set("unreadNum",0),r.save(null,{success:function(n){CacheUpdateChat(n),e.successFunction(n)}})}else CacheUpdateChat(n),e.successFunction(n)}})}function ParsePullChatMessage(e,n,s,r,t,a){var c=Parse.Object.extend("Message"),u=new Parse.Query(c);u.equalTo("groupId",e),u.descending(s),null!=r&&u.lessThan("createdAt",r),u.limit(n),u.find({success:function(e){t(e,a);for(var n=0;n<e.length;n++)CacheUpdateMessage(e[n])}})}function ParsePullAllMessageByGroupIdForCache(e,n,s,r){var t=Parse.Object.extend("Message"),a=new Parse.Query(t);a.equalTo("groupId",e),a.find({success:function(t){for(var a=0;a<t.length;a++)CacheUpdateMessage(t[a]);CachePullChatMessage(e,n,s,r)}})}function ParseAddChatMessage(e,n,s,r){var t=Parse.Object.extend("Message"),a=new t;a.set("senderId",e),a.set("groupId",n),a.set("text",s),a.save(null,{success:function(e){r(e),CacheUpdateMessage(e)}})}function ParseSetChatObjectReadFalseByCurrentIndexAndGroupId(e,n,s,r,t,a){var c=Parse.Object.extend("Chat"),u=new Parse.Query(c),o=n[s];u.equalTo("ownerId",o),u.equalTo("groupId",r),u.first(e!=o?{success:function(u){if("undefined"==typeof u){var i=new c;i.set("ownerId",o),i.set("groupId",r),i.set("hidden",!1),i.set("unreadNum",1),i.save(null,{success:function(c){a(e,t,o),s+1<n.length&&ParseSetChatObjectReadFalseByCurrentIndexAndGroupId(e,n,s+1,r,t,a)}})}else u.increment("unreadNum",1),u.set("hidden",!1),u.save(null,{success:function(c){a(e,t,o),s+1<n.length&&ParseSetChatObjectReadFalseByCurrentIndexAndGroupId(e,n,s+1,r,t,a)}})}}:{success:function(c){c.set("hidden",!1),c.save(null,{success:function(c){CacheUpdateChat(c),s+1<n.length&&ParseSetChatObjectReadFalseByCurrentIndexAndGroupId(e,n,s+1,r,t,a)}})}})}function ParseSetGroupMemberChatObjectReadFalse(e,n,s,r){var t=Parse.Object.extend("Group"),a=new Parse.Query(t);a.equalTo("objectId",n),a.first({success:function(t){CacheUpdateGroup(t);var a=t.get("memberId");ParseSetChatObjectReadFalseByCurrentIndexAndGroupId(e,a,0,n,s,r)}})}function ParsePullMyChat(e,n,s){var r=Parse.Object.extend("Chat"),t=new Parse.Query(r);t.equalTo("ownerId",e),t.equalTo("hidden",!1),t.descending(n),t.find({success:function(e){s(e);for(var n=0;n<e.length;n++)CacheUpdateChat(e[n])}})}function ParsePullUnreadChat(e,n,s){var r=Parse.Object.extend("Chat"),t=new Parse.Query(r);t.equalTo("ownerId",e),t.equalTo("hidden",!1),t.descending(n),t.greaterThan("unreadNum",0),t.find({success:function(e){s(e);for(var n=0;n<e.length;n++)CacheUpdateChat(e[n])}})}function ParseHideChat(e,n,s,r){var t=Parse.Object.extend("Chat"),a=new Parse.Query(t);null!=e?a.equalTo("objectId",e):(a.equalTo("ownerId",ownerUd),a.equalTo("groupId",s)),a.first({success:function(e){e.set("hidden",!0),e.save(null,{success:function(e){CacheUpdateChat(e),r(e)}})}})}function ParseDeleteChat(e,n,s,r){var t=Parse.Object.extend("Chat"),a=new Parse.Query(t);null!=e?a.equalTo("objectId",e):(a.equalTo("ownerId",n),a.equalTo("groupId",s)),a.first({success:function(e){e.destroy({success:function(e){CacheDeleteChat(e),r(e)}})}})}function ParseUploadImages(e){var n=e.src,s=new Parse.File("event_photo",{base64:n});s.save().then(function(n){e.src=n.url()})}function ParseUpdateCache(e,n,s){var r=Parse.Object.extend(e),t=new Parse.Query(r);t.containedIn("objectId",n),t.greaterThan("updatedAt",s),t.find({success:function(n){for(var s=0;s<n.length;s++)switch(e){case"Photo":CacheUpdatePhoto(n[s]);break;case"User":CacheUpdateUser(n[s]);break;case"Friend":CacheUpdateFriend(n[s]);break;case"Chat":CacheUpdateChat(n[s]);break;case"Group":CacheUpdateGroup(n[s]);break;case"Message":CacheUpdateMessage(n[s])}}})}function ParseUpdateGCMId(e,n){var s=Parse.User.current();s.set("GCMId",e.toString()),s.save(null,{success:function(e){n(e),CacheUpdateUser(e)}})}function ParseUpdateAPNId(e,n){var s=Parse.User.current();s.set("APNId",e.toString()),s.save(null,{success:function(e){n(e),CacheUpdateUser(e)}})}function ParseUserNameFieldUpdate(e){var n=Parse.Object.extend("Comment"),s=new Parse.Query(n);s.descending("createdAt"),s.find({success:function(n){var s=new Parse.Query(Parse.User),r=n[e].get("owner"),t=n[e].id;s.equalTo("obejctId",r),s.find({success:function(e){var n=e[0].get("name"),s=Parse.Object.extend("Comment"),r=new Parse.Query(s);r.get(t,{success:function(e){e.set("ownerName",n),e.save(null,{success:function(e){}})},error:function(e,n){}})},error:function(e,n){}})}})}function ParseRefreshComment(){ParseOwnerFieldUpdate(),refreshNumber+=1,293!=refreshNumber&&setTimeout(function(){ParseRefreshComment()},1e3)}function ParseOwnerFieldUpdate(){var e=Parse.Object.extend("Comment"),n=new Parse.Query(e);n.descending("createdAt"),n.find({success:function(e){var n=e[refreshNumber].get("owner"),s=function(e,n){n.comment.set("owner",e.id),n.comment.save(null,{success:function(e){console.log(e.get("owner"))}})};CacheGetProfileByUsername(n,s,{comment:e[refreshNumber]})}})}function ParsePhotoClassCreateBaseUserObject(e){var n=new Parse.Query(Parse.User);n.descending("createdAt"),n.find({success:function(n){var s=n[e].id,r=n[e].get("photo"),t=n[e].get("photo50"),a=Parse.Object.extend("Photo"),c=new a;c.set("userId",s),c.set("profilePhoto",r),c.set("profilePhoto120",t),c.save(null,{success:function(){}})}})}function ParseRefreshUserProfilePhoto(){ParsePhotoClassCreateBaseUserObject(refreshNumber),refreshNumber+=1,16!=refreshNumber&&setTimeout(function(){ParseRefreshUserProfilePhoto()},5e3)}function ParseClearChatWithoutMessage(){var e=Parse.Object.extend("Chat"),n=new Parse.Query(e);n.find({success:function(e){ChatObjectSet=e,ParseCheckChatObject()}})}function ParseCheckChatObject(){var e=ChatObjectSet[refreshNumber],n=e.get("groupId"),s=Parse.Object.extend("Message"),r=new Parse.Query(s);r.descending("createdAt"),r.equalTo("groupId",n),r.first({success:function(e){"undefined"==typeof e&&(ChatObjectSet[refreshNumber].set("hidden",!0),ChatObjectSet[refreshNumber].save({success:function(){}}))}}),refreshNumber!=ChatObjectSet.length-1&&setTimeout(function(){refreshNumber+=1,ParseCheckChatObject()},5e3)}function ParseNoticeNewVersion(){var e=Parse.Object.extend("User"),n=new Parse.Query(e);n.find({success:function(e){NoticeNewVersionObjects=e,SendNewVersionNotification(0)}})}function SendNewVersionNotification(e){if(!(e>=NoticeNewVersionObjects.length)){var n=NoticeNewVersionObjects[e];console.log(n.id),"undefined"!=typeof n.get("GCMId")&&(pushNotificationToDevice("gcm",n.get("GCMId"),"New version is available."),console.log("GCMId:"+n.get("GCMId"))),"undefined"!=typeof n.get("APNId")&&(pushNotificationToDevice("apn",n.get("APNId"),"New version is available."),console.log("APNId:"+n.get("APNId"))),setTimeout(function(){SendNewVersionNotification(e+1)},1e3)}}Parse.initialize("uFgE3rx2fcIDcWXQgjzuE70VF5WBH76I3TFkwo7W","21lb7CMEkfLUurx1ETYa805EVu6KYU2WeluLIJ73");var refreshNumber=0,ChatObjectSet,NoticeNewVersionObjects;